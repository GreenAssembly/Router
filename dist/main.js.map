{"mappings":"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","sources":["src/index.js"],"sourcesContent":["class Event {\n    #events = new Map();\n\n    on(event_name, callback) {\n        this.#events.set(event_name, callback);\n    }\n\n    fire(event_name, args = []) {\n        if (this.#events.has(event_name)) {\n            this.#events.get(event_name)(...args);\n        }\n    }\n}\n\nclass Route extends Event {\n    constructor(title, frames, scripts, links) {\n        super();\n\n        this.title = title;\n        this.last_loaded_time = new Date();\n        this.frames = frames;\n        this.scripts = scripts;\n        this.links = links;\n    }\n\n    render(router) {\n        this.last_loaded_time = new Date();\n\n        document.title = this.title;\n        window.scrollTo(0, 0);\n\n        // Load all scripts and stylesheets\n        let loadings = [];\n\n        this.links.forEach(href => {\n            loadings.push(\n                new Promise((resolve, _) => {\n                    let link = document.createElement('link');\n                    link.setAttribute('rel', 'stylesheet');\n                    link.setAttribute('href', href);\n                    link.onload = resolve;\n                    document.head.appendChild(link);\n                })\n            );\n        });\n\n        this.scripts.forEach(src => {\n            loadings.push(\n                new Promise((resolve, _) => {\n                    let script = document.createElement('script');\n                    script.setAttribute('type', 'text/javascript');\n                    script.setAttribute('src', src);\n                    script.onload = resolve;\n                    document.head.appendChild(script);\n                })\n            );\n        });\n\n        // When all scrips and stylesheets are loaded then render frames\n        Promise.all(loadings)\n            .then(() => {\n                for (const frame of document.querySelectorAll('ga-frame')) {\n                    const frame_name = frame.getAttribute('name');\n\n                    if (this.frames.has(frame_name)) {\n                        const page_frame = this.frames.get(frame_name);\n\n                        frame.innerHTML = page_frame;\n                        // TODO : bind follow behavior to frame links\n                        Route.init_links(frame, router);\n                    }\n                }\n\n                this.fire('mount');\n                // TODO : router.fire('change');\n                router.fire('change');\n            });\n    }\n\n    clean() {\n        this.links.forEach(href => document.head.querySelector(`link[href=\"${href}\"]`).remove());\n        this.scripts.forEach(src => {\n            document.head.querySelector(`script[src=\"${src}\"]`).remove()\n        });\n    }\n\n    static init_links(frame, router) {\n        frame\n            .querySelectorAll('[o-follow]')\n            .forEach(link => {\n                const o_follow = link.getAttribute('o-follow');\n                const href = link.getAttribute('href').substr(1);\n        \n                link.addEventListener('click', e => {\n                    e.preventDefault();\n        \n                    // Cannot click on link which target the same location as the current\n                    if (href === router.current_path) {\n                        return;\n                    }\n        \n                    router.fire('loading');\n                    const prev_url = router.current_path;\n        \n                    history.pushState({}, null, href);\n        \n                    router.pages.get(prev_url).clean();\n                    router.push(href);\n                });\n        \n                // Only bind event on follow link which have preload-once or preload value\n                if (['preload-once', 'preload'].includes(o_follow)) {\n                    link.addEventListener('mouseover', () => {\n                        if (o_follow === 'preload-once') {\n                            if (!router.pages.has(href)) {\n                                router.handle_url(href, true, false);\n                            }\n                        } else if (o_follow === 'preload') {\n                            router.handle_url(href, false, false);\n                        }\n                    });\n                }\n            });\n    }\n}\n\nconst extract_scripts = doc => [...doc.querySelectorAll('script')]\n    .filter(script => script.getAttribute('o-no-load') === null && script.getAttribute('src') !== null)\n    .map(script => script.attributes.src.nodeValue);\n\nconst extract_stylesheets = doc => [...doc.querySelectorAll('head > link[rel=stylesheet]')]\n    .filter(link => link.getAttribute('o-no-load') === null)\n    .map(link => link.attributes.href.nodeValue);\n\nconst extract_frames = doc => new Map([...doc.querySelectorAll('ga-frame')].map(frame => {\n        return [frame.getAttribute('name'), frame.innerHTML]\n    }));\n\nexport default class Router extends Event {\n    #cache = new Map();\n    #parser = new DOMParser();\n    #init = false;\n\n    get pages() {\n        return new Proxy(this.#cache, {\n            get(target, name) {\n                let res = Reflect.get(target, name);\n\n                if (typeof res === 'function' && (name === 'get' || name === 'has')) {\n                    res = res.bind(target);\n                }\n\n                return res\n            }\n        });\n    }\n\n    constructor() {\n        super();\n        // Init current page now to allow to link some events\n        const current_page = new Route(null, null, null, null);\n        this.#cache.set(this.current_path, current_page);\n\n        // Init behavior when DOM is mounted\n        document.addEventListener('readystatechange', e => {\n            // e.target.readyState === 'interactive' || \n            if ((e.target.readyState === 'complete') && !this.#init) {\n                // Prevent to execute each time the readyState change\n                this.#init = true;\n\n                current_page.title = document.title;\n                current_page.frames = extract_frames(document);\n                current_page.scripts = extract_scripts(document);;\n                current_page.links = extract_stylesheets(document);\n\n                Route.init_links(document, this);\n                // this.#init_links(document);\n                current_page.fire('mount');\n        \n                window.addEventListener('popstate', () => {\n                    // Find previous page and clean it\n                    const last_page_visited = [...this.#cache.entries()].sort((a, b) => {\n                        if (a[1].last_loaded_time < b[1].last_loaded_time)\n                            return 1\n                        if (a[1].last_loaded_time > b[1].last_loaded_time)\n                            return -1;\n        \n                        return 0\n                    })[0][1];\n            \n                    last_page_visited.fire('destroy');\n                    last_page_visited.clean();\n        \n                    // Render new route\n                    if (this.#cache.has(this.current_path)) {\n                        this.#cache.get(this.current_path).render(this);\n                    }\n                });\n            }\n        })\n    }\n\n    push(location, from_cache = true) {\n        if (from_cache && this.#cache.has(this.current_path)) {\n            this.#cache.get(this.current_path).render(this);\n        } else {\n            this.handle_url(location, true, true);\n        }\n    }\n\n    get current_path() {\n        return location.pathname.substr(1);\n    }\n\n    async handle_url(url, add_to_cache = true, do_rendering = true) {\n        let page = null;\n        let res = await fetch(url, {\n            headers: new Headers({\n                'GAR-LOG': null\n            })\n        });\n        const text = await res.text();\n\n        if (res.ok) {\n            const parsed_fragment = this.#parse(text);\n\n            if (add_to_cache) {\n                this.#cache.set(url, parsed_fragment);\n            }\n\n            if (!do_rendering) {\n                return;\n            }\n\n            page = parsed_fragment;\n        } else if (res.status === 404) {\n            if (!res) {\n                return;\n            }\n\n            page = this.#parse(text);\n        }\n\n        page.render(this);\n    }\n\n    #parse(content) {\n        const doc = this.#parser.parseFromString(content, 'text/html');\n\n        return new Route(\n            doc.title,\n            extract_frames(doc),\n            extract_scripts(doc),\n            extract_stylesheets(doc)\n        )\n    }\n\n    on(event_name, callback) {\n        switch (event_name) {\n            case 'mount':\n            case 'destroy':\n                this.#cache.get(this.current_path).on(event_name, callback);\n            break;\n\n            case 'loading':\n            case 'change':\n                super.on('change', callback);\n            break;\n            default:\n                throw new TypeError('Unrecognized event')\n        }\n    }\n}\n\nif (window.router === undefined) {\n    window.router = new Router();\n}"],"names":[],"version":3,"file":"main.js.map"}