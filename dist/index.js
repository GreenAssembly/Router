!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.router=t():e.router=t()}(self,(function(){return function(){"use strict";var e={d:function(t,n){for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:function(){return n}});class n{constructor(){this.cache={},this.onMountEvent=new Event("onMount"),this.onDestroyEvent=new Event("onDestroy"),this.parser=new DOMParser;const e={};for(const t of document.querySelectorAll("ga-frame"))e[t.getAttribute("name")]=t.innerHTML;this.caching(location.href,document.title,e,[...document.querySelectorAll("script")].filter((e=>null===e.getAttribute("o-no-load")&&null!==e.getAttribute("src"))).map((e=>e.attributes.src.nodeValue)),[...document.querySelectorAll("head > link[rel=stylesheet]")].filter((e=>null===e.getAttribute("o-no-load"))).map((e=>e.attributes.href.nodeValue))),window.dispatchEvent(this.onMountEvent),window.addEventListener("popstate",(e=>{window.dispatchEvent(new Event("router:loading",{bubbles:!0,cancelable:!1})),window.dispatchEvent(this.onDestroyEvent);const t=Object.entries(this.cache).sort(((e,t)=>e[1].last_loaded_time<t[1].last_loaded_time?1:e[1].last_loaded_time>t[1].last_loaded_time?-1:0))[0][0];this.clean(t),this.handle_url(location.href)})),document.body.addEventListener("click",(e=>{const t=e.target instanceof HTMLAnchorElement?e.target:e.target.parentElement instanceof HTMLAnchorElement?e.target.parentElement:e.target.parentElement instanceof HTMLPictureElement?e.target.parentElement.parentElement:null;t&&t.href===window.location.href?e.preventDefault():t&&t.matches("[o-follow]")&&(e.preventDefault(),window.dispatchEvent(new Event("router:loading",{bubbles:!0,cancelable:!1})),window.dispatchEvent(this.onDestroyEvent),history.pushState({prevUrl:location.href},null,t.href),this.clean(window.history.state.prevUrl),this.handle_url(t.href,!0,!0))}));const t=document.querySelectorAll("[o-preload]"),n=document.querySelectorAll("[o-preload-once]");for(const e of n)for(const n of t)e==n&&console.warn("A link has [o-preload-once] and [o-preload] tags at the same time");for(const e of t)e.addEventListener("mouseover",(()=>{this.handle_url(e.href,!0,!1)})),e.addEventListener("mouseleave",(e=>{}));for(const e of n)e.addEventListener("mouseover",(()=>{this.cache[e.href]||this.handle_url(e.href,!0,!1)}))}onMount(e){this.cache[location.href].onMount=e,window.addEventListener("onMount",this.cache[location.href].onMount)}onDestroy(e){this.cache[location.href].onDestroy=e,window.addEventListener("onDestroy",this.cache[location.href].onDestroy)}caching(e,t,n,o,r){this.cache[e]={frames:n,title:t,last_loaded_time:Date.now(),scripts:o,links:r}}async handle_url(e,t=!0,n=!0){let o=this.cache[e];if(o)o.last_loaded_time=Date.now(),!0===n&&this.render(o);else{let r=new Headers;r.append("GAR-Log",!1);let l=await fetch(e,{headers:r});if(l.ok){l=await l.text();let r=this.parse(l);t&&this.caching(e,r.title,r.frames,r.scripts,r.links),o=r,o.last_loaded_time=Date.now(),!0===n&&this.render(o)}else if(404===l.status){let e=this.parse(await l.text());this.render(e)}}}parse(e){const t=this.parser.parseFromString(e,"text/html"),n={};for(const e of t.querySelectorAll("ga-frame"))n[e.getAttribute("name")]=e.innerHTML;return{title:t.title,frames:n,scripts:[...t.querySelectorAll("script")].filter((e=>null===e.getAttribute("o-no-load")&&null!==e.getAttribute("src"))).map((e=>e.attributes.src.nodeValue)),links:[...t.querySelectorAll("head > link[rel=stylesheet]")].filter((e=>null===e.getAttribute("o-no-load"))).map((e=>e.attributes.href.nodeValue))}}render(e){let t=[];e.scripts.forEach((e=>{t.push(new Promise(((t,n)=>{let o=document.createElement("script");o.type="text/javascript",o.src=e,o.onload=t,document.head.appendChild(o)})))})),document.title=e.title,window.scrollTo(0,0),e.links.forEach((e=>{t.push(new Promise(((t,n)=>{let o=document.createElement("link");o.rel="stylesheet",o.href=e,o.onload=t,document.head.appendChild(o)})))})),Promise.all(t).then((()=>{for(let t of document.querySelectorAll("ga-frame")){const n=e.frames[t.getAttribute("name")];void 0!==n&&(t.innerHTML=n)}window.dispatchEvent(this.onMountEvent),e.onMount&&window.addEventListener("onMount",e.onMount),e.onDestroy&&window.addEventListener("onDestroy",e.onDestroy),window.dispatchEvent(new Event("router:change"))}))}clean(e){const t=this.cache[e];t?(t.links.forEach((e=>{document.head.querySelector(`link[href="${e}"]`).remove()})),t.scripts.forEach((e=>{document.head.querySelector(`script[src="${e}"]`).remove()}))):([...document.querySelectorAll("script")].filter((e=>null===e.getAttribute("o-no-load"))).forEach((e=>e.remove())),[...document.querySelectorAll("head > link[rel=stylesheet]")].filter((e=>null===e.getAttribute("o-no-load"))).forEach((e=>e.remove())))}}return t}()}));