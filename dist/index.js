!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.router=t():e.router=t()}(self,(function(){return function(){"use strict";var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:function(){return r}});class r{constructor(){this.cache=new Map,this.parser=new DOMParser;const e=new Map;for(const t of document.querySelectorAll("ga-frame"))e.set(t.getAttribute("name"),t.innerHTML);window.addEventListener("popstate",(()=>{window.dispatchEvent(new Event("ga-router:loading",{bubbles:!0,cancelable:!1})),window.dispatchEvent(new Event("onDestroy"));const e=[...this.cache.entries()].sort(((e,t)=>e[1].last_loaded_time<t[1].last_loaded_time?1:e[1].last_loaded_time>t[1].last_loaded_time?-1:0));this.clean(e),this.handle_url(location.href)}))}caching(e,t,r,n,o){this.cache.set(e,{frames:r,title:t,last_loaded_time:Date.now(),scripts:n,links:o})}async handle_url(e,t=!0,r=!0){let n=this.cache.get(e);if(n)return n.last_loaded_time=Date.now(),void(r&&this.render(n));let o=new Headers;o.append("GAR-LOG",null);let a=await fetch(e,{headers:o});if(a.ok){a=await a.text();const o=this.parse(a);t&&this.caching(e,o.title,o.frames,o.scripts,o.links),n=o,n.last_loaded_time=Date.now(),r&&this.render(n)}else if(404===a.status){let e=this.parse(await a.text());this.render(e)}}parse(e){const t=this.parser.parseFromString(e,"text/html"),r=new Map;for(const e of t.querySelector("ga-frame"))r.set(e.getAttribute("name"),e.innerHTML);return{title:t.title,frames:r,scripts:[...t.querySelectorAll("script")].filter((e=>null===e.getAttribute("o-no-load")&&null!==e.getAttribute("src"))).map((e=>e.attributes.src.nodeValue)),links:[...t.querySelectorAll("head > link[rel=stylesheet")].filter((e=>null===e.getAttribute("o-no-load"))).map((e=>e.attributes.href.nodeValue))}}}return t}()}));