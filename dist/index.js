!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.router=t():e.router=t()}(self,(function(){return function(){"use strict";var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:function(){return a}});class r{#events=new Map;on(e,t){this.#events.set(e,t)}fire(e,t=[]){console.log("fire",e),this.#events.has(e)&&this.#events.get(e)(...t)}}class n extends r{constructor(e,t,r,n){super(),this.title=e,this.last_loaded_time=new Date,this.frames=t,this.scripts=r,this.links=n}render(e){this.last_loaded_time=new Date,document.title=this.title,window.scrollTo(0,0);let t=[];this.links.forEach((e=>{t.push(new Promise(((t,r)=>{let n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href",e),n.onload=t,document.head.appendChild(n)})))})),this.scripts.forEach((e=>{t.push(new Promise(((t,r)=>{let n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",e),n.onload=t,document.head.appendChild(n)})))})),Promise.all(t).then((()=>{for(const t of document.querySelectorAll("ga-frame")){const r=t.getAttribute("name");if(this.frames.has(r)){const s=this.frames.get(r);t.innerHTML=s,n.init_links(t,e)}}this.fire("mount")}))}clean(){this.links.forEach((e=>document.head.querySelector(`link[href="${e}"]`).remove())),this.scripts.forEach((e=>{console.log(e),document.head.querySelector(`script[src="${e}"]`).remove()}))}static init_links(e,t){e.querySelectorAll("[o-follow]").forEach((e=>{const r=e.getAttribute("o-follow"),n=e.getAttribute("href").substr(1);e.addEventListener("click",(e=>{if(e.preventDefault(),n===t.current_path)return;t.fire("loading");const r=t.current_path;history.pushState({},null,n),t.pages.get(r).clean(),t.push(n)})),["preload-once","preload"].includes(r)&&e.addEventListener("mouseover",(()=>{"preload-once"===r?t.pages.has(n)||t.handle_url(n,!0,!1):"preload"===r&&t.handle_url(n,!1,!1)}))}))}}const s=e=>[...e.querySelectorAll("script")].filter((e=>null===e.getAttribute("o-no-load")&&null!==e.getAttribute("src"))).map((e=>e.attributes.src.nodeValue)),o=e=>[...e.querySelectorAll("head > link[rel=stylesheet]")].filter((e=>null===e.getAttribute("o-no-load"))).map((e=>e.attributes.href.nodeValue)),i=e=>new Map([...e.querySelectorAll("ga-frame")].map((e=>[e.getAttribute("name"),e.innerHTML])));class a extends r{#cache=new Map;#parser=new DOMParser;#init=!1;get pages(){return new Proxy(this.#cache,{get(e,t){let r=Reflect.get(e,t);return"function"!=typeof r||"get"!==t&&"has"!==t||(r=r.bind(e)),r}})}constructor(){super();const e=new n(null,null,null,null);this.#cache.set(this.current_path,e),document.addEventListener("readystatechange",(t=>{"complete"!==t.target.readyState||this.#init||(console.log(t.target.readyState),this.#init=!0,e.title=document.title,e.frames=i(document),e.scripts=s(document),e.links=o(document),n.init_links(document,this),e.fire("mount"),window.addEventListener("popstate",(()=>{const e=[...this.#cache.entries()].sort(((e,t)=>e[1].last_loaded_time<t[1].last_loaded_time?1:e[1].last_loaded_time>t[1].last_loaded_time?-1:0))[0][1];e.fire("destroy"),e.clean(),this.#cache.has(this.current_path)&&this.#cache.get(this.current_path).render(this)})))}))}push(e,t=!0){t&&this.#cache.has(this.current_path)?this.#cache.get(this.current_path).render(this):this.handle_url(e,!0,!0)}get current_path(){return location.pathname.substr(1)}async handle_url(e,t=!0,r=!0){let n=null,s=await fetch(e,{headers:new Headers({"GAR-LOG":null})});const o=await s.text();if(s.ok){const s=this.#parse(o);if(t&&this.#cache.set(e,s),!r)return;n=s}else if(404===s.status){if(!s)return;n=this.#parse(o)}n.render(this)}#parse(e){const t=this.#parser.parseFromString(e,"text/html");return new n(t.title,i(t),s(t),o(t))}on(e,t){switch(console.log("attach event",e),e){case"mount":case"destroy":this.#cache.get(this.current_path).on(e,t);break;case"loading":case"change":this.on(e,t);break;default:throw new TypeError("Unrecognized event")}}}return void 0===window.router&&(window.router=new a),t}()}));